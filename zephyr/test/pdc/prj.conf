# Copyright 2024 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

CONFIG_ZTEST=y

# Basic EC functions
CONFIG_SHIMMED_TASKS=y
CONFIG_CROS_EC=y
CONFIG_PLATFORM_EC=y
CONFIG_PLATFORM_EC_HOOKS=y
CONFIG_PLATFORM_EC_HOSTCMD=y

# Console
CONFIG_SHELL_BACKEND_DUMMY=y
CONFIG_SHELL_BACKEND_DUMMY_BUF_SIZE=1000
CONFIG_SHELL_BACKEND_SERIAL=n
CONFIG_SERIAL=y
CONFIG_RING_BUFFER=y

# Logging is configured to send output to the shell, disable
# the UART backed to prevent duplicate messages in the output.
CONFIG_LOG_BACKEND_UART=n

# Emulated PDC
CONFIG_EMUL=y

# Disable BC1.2
CONFIG_PLATFORM_EC_USB_CHARGER=n

CONFIG_PLATFORM_EC_CHARGER=y
CONFIG_PLATFORM_EC_CHARGER_SENSE_RESISTOR=10
CONFIG_PLATFORM_EC_CHARGER_SENSE_RESISTOR_AC=10
CONFIG_PLATFORM_EC_CHARGER_ISL9238=y

# Turn off other unneeded features
CONFIG_PLATFORM_EC_BACKLIGHT_LID=n
CONFIG_PLATFORM_EC_VBOOT_HASH=n
CONFIG_PLATFORM_EC_SWITCH=n
CONFIG_PLATFORM_EC_USBC_SS_MUX=n

# Disable [TCPMv2] Power Delivery Function
CONFIG_PLATFORM_EC_USB_POWER_DELIVERY=n
CONFIG_PLATFORM_EC_USBC_PPC=n
CONFIG_PLATFORM_EC_USB_PD_PPC=n
CONFIG_PLATFORM_EC_HOSTCMD_PD_CONTROL=n
CONFIG_PLATFORM_EC_HOSTCMD_RWHASHPD=n

# Disable typec host commands until a PDC counterpart exists.
CONFIG_PLATFORM_EC_HOSTCMD_TYPEC_DISCOVERY=n
CONFIG_PLATFORM_EC_HOSTCMD_TYPEC_CONTROL=n
CONFIG_PLATFORM_EC_HOSTCMD_TYPEC_STATUS=n
CONFIG_PLATFORM_EC_HOSTCMD_PD_CHIP_INFO=n

# Use PD Controller
CONFIG_PLATFORM_EC_USBC=y
CONFIG_PLATFORM_EC_USB_PD_CONTROLLER=y
CONFIG_PLATFORM_EC_USB_PD_VBUS_MEASURE_NOT_PRESENT=y
CONFIG_PLATFORM_EC_USB_PD_DISCHARGE=n

# Allow more time in unit tests for the PDC Power Mgmt state machine to reach
# a steady state. TODO(b/372259212): Investigate what's holding up the sequence
CONFIG_PDC_POWER_MGMT_STATE_MACHINE_SETTLED_TIMEOUT_MS=2500

# Charger
CONFIG_PLATFORM_EC_BATTERY_FUEL_GAUGE=y
CONFIG_PLATFORM_EC_CHARGER_ISL9238=y
CONFIG_PLATFORM_EC_CHARGER_SENSE_RESISTOR=10
CONFIG_PLATFORM_EC_CHARGER_SENSE_RESISTOR_AC=20
CONFIG_PLATFORM_EC_CHARGER_MIN_POWER_MW_FOR_POWER_ON=30000
CONFIG_PLATFORM_EC_CHARGER_MIN_POWER_MW_FOR_POWER_ON_WITH_BATT=15000

CONFIG_USB_PDC_POWER_MGMT=y

# Print logs from Zephyr LOG_MODULE to stdout
CONFIG_NATIVE_UART_0_ON_STDINOUT=y
CONFIG_LOG_BACKEND_SHOW_COLOR=n

CONFIG_PLATFORM_EC_USB_PD_VBUS_MEASURE_NOT_PRESENT=y
